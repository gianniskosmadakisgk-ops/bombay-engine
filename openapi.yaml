openapi: 3.1.0
info:
  title: Bombay Engine API
  version: 1.1.0
  description: |
    Internal API for Agent Bombay.
    IMPORTANT:
    - Thursday endpoint is CHUNKED to avoid ResponseTooLargeError.
    - Custom GPT MUST read ONLY response.report.
servers:
  - url: https://bombay-engine.onrender.com

paths:
  /healthcheck:
    get:
      operationId: healthcheck
      summary: Health check
      responses:
        "200":
          description: ok
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HealthcheckResponse"

  /thursday-analysis-v3:
    get:
      operationId: runThursdayAnalysis
      summary: Thursday Report V3 (latest saved report) - CHUNKED
      description: |
        Returns the latest saved Thursday Report V3 from logs/thursday_report_v3.json.
        Does NOT run the engine.
        Returns response.report with chunk metadata + fixtures filtered by league page.
        Custom GPT must read response.report.
      parameters:
        - in: query
          name: cursor
          schema:
            type: integer
            minimum: 0
          description: League page cursor (default 0)
        - in: query
          name: per_page
          schema:
            type: integer
            minimum: 1
            maximum: 5
          description: Leagues per response (default 3)
        - in: query
          name: lite
          schema:
            type: boolean
          description: If true, drops heavy fields (default true)
        - in: query
          name: leagues
          schema:
            type: string
          description: Comma-separated league names override cursor paging
      responses:
        "200":
          description: ok
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OkWithReport"
        "404":
          description: report not available
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorWithReportNull"

  /friday-shortlist-v3:
    get:
      operationId: runFridayShortlist
      summary: Friday Shortlist V3 (latest saved report)
      description: |
        Returns the latest saved Friday shortlist from logs/friday_shortlist_v3.json.
        Does NOT run scripts.
        Custom GPT must read response.report.
      responses:
        "200":
          description: ok
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OkWithReport"
        "404":
          description: report not available
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorWithReportNull"

  /tuesday-recap:
    get:
      operationId: runTuesdayRecap
      summary: Tuesday Recap (latest saved report)
      description: |
        Returns the latest saved Tuesday recap from logs/tuesday_recap_v3.json.
        Does NOT run scripts.
        Custom GPT must read response.report.
      responses:
        "200":
          description: ok
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OkWithReport"
        "404":
          description: recap not available
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorWithReportNull"

components:
  schemas:
    HealthcheckResponse:
      type: object
      additionalProperties: true
      required: [status, message, timestamp]
      properties:
        status: { type: string, example: "ok" }
        message: { type: string, example: "Bombay Engine alive" }
        timestamp: { type: string, format: date-time }

    OkWithReport:
      type: object
      additionalProperties: true
      required: [status, timestamp, report]
      properties:
        status: { type: string, example: "ok" }
        timestamp: { type: string, format: date-time }
        report:
          type: object
          additionalProperties: true

    ErrorWithReportNull:
      type: object
      additionalProperties: true
      required: [status, message, timestamp, report]
      properties:
        status: { type: string, example: "error" }
        message: { type: string, example: "Report not available" }
        error:
          type: ["string","null"]
        timestamp: { type: string, format: date-time }
        report:
          type: ["object","null"]
          example: null
