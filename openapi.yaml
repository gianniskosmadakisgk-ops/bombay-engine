openapi: 3.1.0
info:
  title: Bombay Engine API
  version: 1.1.0
  description: |
    Bombay Engine API (V3).
    IMPORTANT:
    - Thursday endpoint returns the latest saved Thursday Report V3 inside 'report'.
      Supports optional chunking via query params cursor/per_page/lite to avoid huge outputs.
    - Friday endpoint returns the latest saved Friday Shortlist V3 inside 'report' (server already ran it).
    - Tuesday endpoint returns the latest saved Tuesday Recap V3 inside 'report'.

servers:
  - url: https://bombay-engine.onrender.com

paths:
  /healthcheck:
    get:
      operationId: healthcheck
      summary: Health check
      responses:
        "200":
          description: ok
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true

  /thursday-analysis-v3:
    get:
      operationId: thursdayAnalysisV3
      summary: Thursday Report V3 (latest saved report, optional chunking)
      description: |
        Returns the latest saved Thursday Report V3 from logs/thursday_report_v3.json inside response.report.
        Optional chunking:
          - cursor: index of league page (0..)
          - per_page: number of leagues in this chunk (1..10)
          - lite: true removes some heavy fields for smaller payload
      parameters:
        - name: cursor
          in: query
          required: false
          schema: { type: integer, minimum: 0 }
        - name: per_page
          in: query
          required: false
          schema: { type: integer, minimum: 1, maximum: 10 }
        - name: lite
          in: query
          required: false
          schema: { type: boolean }
      responses:
        "200":
          description: ok
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OkWithReport"
        "404":
          description: report not available
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorWithReportNull"

  /friday-shortlist-v3:
    get:
      operationId: fridayShortlistV3
      summary: Friday Shortlist V3 (latest saved report)
      description: |
        Returns the latest saved Friday shortlist from logs/friday_shortlist_v3.json inside response.report.
      responses:
        "200":
          description: ok
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OkWithReport"
        "404":
          description: report not available
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorWithReportNull"

  /tuesday-recap:
    get:
      operationId: tuesdayRecapV3
      summary: Tuesday Recap V3 (latest saved report)
      description: |
        Returns the latest saved Tuesday recap from logs/tuesday_recap_v3.json inside response.report.
      responses:
        "200":
          description: ok
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OkWithReport"
        "404":
          description: recap not available
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorWithReportNull"

components:
  schemas:
    OkWithReport:
      type: object
      additionalProperties: true
      required: [status, timestamp, report]
      properties:
        status:
          type: string
          example: ok
        timestamp:
          type: string
          format: date-time
        report:
          type: object
          additionalProperties: true

    ErrorWithReportNull:
      type: object
      additionalProperties: true
      required: [status, message, timestamp, report]
      properties:
        status:
          type: string
          example: error
        message:
          type: string
          example: report not available
        error:
          type: [string, "null"]
        timestamp:
          type: string
          format: date-time
        report:
          type: ["object", "null"]
          example: null
