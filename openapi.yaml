openapi: 3.1.0
info:
  title: Bombay Engine API
  version: 1.0.5
  description: |
    Bombay Engine API (Render).
    - Thursday endpoint returns SAVED report (logs/thursday_report_v3.json) inside `report`.
      Supports chunking via query params to avoid ResponseTooLargeError.
    - Friday endpoint returns SAVED report (logs/friday_shortlist_v3.json) inside `report`.
    - Tuesday endpoint returns SAVED report (logs/tuesday_recap_v3.json) inside `report`.
servers:
  - url: https://bombay-engine.onrender.com

paths:
  /healthcheck:
    get:
      operationId: healthcheck
      summary: Health check
      responses:
        "200":
          description: ok
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HealthcheckResponse"

  /thursday-analysis-v3:
    get:
      operationId: runThursdayAnalysis
      summary: Thursday Report V3 (saved) â€” supports chunking
      description: |
        Returns the latest saved Thursday report from logs/thursday_report_v3.json inside `report`.
        Does NOT run the engine. Supports chunking to avoid large payloads.
      parameters:
        - in: query
          name: cursor
          required: false
          schema: { type: integer, minimum: 0, default: 0 }
          description: League-page cursor (0-based).
        - in: query
          name: per_page
          required: false
          schema: { type: integer, minimum: 1, maximum: 3, default: 2 }
          description: How many leagues to include in this chunk (1..3).
        - in: query
          name: lite
          required: false
          schema: { type: boolean, default: true }
          description: If true, returns a slim fixture payload (only display fields + small flags).
        - in: query
          name: tz
          required: false
          schema:
            type: string
            enum: ["UTC", "Europe/Athens"]
            default: "Europe/Athens"
          description: Adds display-only time fields for the requested timezone.
      responses:
        "200":
          description: ok
          content:
            application/json:
              schema: { $ref: "#/components/schemas/OkWithReport" }
        "404":
          description: report not available
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorWithReportNull" }

  /friday-shortlist-v3:
    get:
      operationId: runFridayShortlist
      summary: Friday Shortlist V3 (saved)
      description: |
        Returns the latest saved Friday shortlist from logs/friday_shortlist_v3.json inside `report`.
        Does NOT run the engine.
      parameters:
        - in: query
          name: tz
          required: false
          schema:
            type: string
            enum: ["UTC", "Europe/Athens"]
            default: "Europe/Athens"
          description: Adds display-only time fields for the requested timezone where possible.
      responses:
        "200":
          description: ok
          content:
            application/json:
              schema: { $ref: "#/components/schemas/OkWithReport" }
        "404":
          description: report not available
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorWithReportNull" }

  /tuesday-recap:
    get:
      operationId: runTuesdayRecap
      summary: Tuesday Recap (saved)
      description: |
        Returns the latest saved Tuesday recap from logs/tuesday_recap_v3.json inside `report`.
        Does NOT run the engine.
      responses:
        "200":
          description: ok
          content:
            application/json:
              schema: { $ref: "#/components/schemas/OkWithReport" }
        "404":
          description: report not available
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorWithReportNull" }

components:
  schemas:
    HealthcheckResponse:
      type: object
      additionalProperties: true
      required: [status, message, timestamp]
      properties:
        status: { type: string, example: ok }
        message: { type: string, example: Bombay Engine alive }
        timestamp: { type: string, format: date-time }

    OkWithReport:
      type: object
      additionalProperties: true
      required: [status, timestamp, report]
      properties:
        status: { type: string, example: ok }
        timestamp: { type: string, format: date-time }
        report:
          type: object
          additionalProperties: true

    ErrorWithReportNull:
      type: object
      additionalProperties: true
      required: [status, message, timestamp, report]
      properties:
        status: { type: string, example: error }
        message: { type: string, example: Report not available }
        error: { type: ["string", "null"] }
        timestamp: { type: string, format: date-time }
        report: { type: ["object", "null"], example: null }
