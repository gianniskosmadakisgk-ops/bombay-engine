openapi: 3.1.0
info:
  title: Bombay Engine API
  version: 1.1.0
  description: |
    Bombay Engine API for Agent Bombay v6.x.

    IMPORTANT RULE:
    - The Custom GPT MUST read ONLY response.report (never infer from anything else).

    Thursday is CHUNKED to avoid "ResponseTooLargeError".
    Use query params cursor/per_page/lite on /thursday-analysis-v3.

servers:
  - url: https://bombay-engine.onrender.com

paths:
  /healthcheck:
    get:
      operationId: healthcheck
      summary: Health check
      responses:
        "200":
          description: ok
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HealthcheckResponse"

  /thursday-analysis-v3:
    get:
      operationId: runThursdayAnalysis
      summary: Thursday Report V3 (latest saved) â€” chunked
      description: |
        Returns the latest saved Thursday Report V3 from logs/thursday_report_v3.json.
        Does NOT run the engine.
        Supports chunking by leagues to avoid oversized responses.

        The Custom GPT must read response.report only.
      parameters:
        - name: cursor
          in: query
          required: false
          schema:
            type: integer
            minimum: 0
          description: League cursor (0-based). If omitted, defaults to 0.
        - name: per_page
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 10
          description: Number of leagues per chunk. If omitted, defaults to 3.
        - name: lite
          in: query
          required: false
          schema:
            type: boolean
          description: If true, returns a lighter fixture payload (drops heavy keys).
      responses:
        "200":
          description: ok
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ThursdayOkChunked"
        "404":
          description: report not available
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorWithReportNull"

  /friday-shortlist-v3:
    get:
      operationId: runFridayShortlist
      summary: Friday Shortlist V3 (latest saved)
      description: |
        Returns the latest saved Friday shortlist from logs/friday_shortlist_v3.json.
        Does NOT run the engine.
        The Custom GPT must read response.report only.
      responses:
        "200":
          description: ok
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OkWithReport"
        "404":
          description: report not available
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorWithReportNull"

  /tuesday-recap:
    get:
      operationId: runTuesdayRecap
      summary: Tuesday Recap V3 (latest saved)
      description: |
        Returns the latest saved Tuesday recap from logs/tuesday_recap_v3.json.
        Does NOT run the engine.
        The Custom GPT must read response.report only.
      responses:
        "200":
          description: ok
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OkWithReport"
        "404":
          description: recap not available
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorWithReportNull"

components:
  schemas:
    HealthcheckResponse:
      type: object
      additionalProperties: true
      required: [status, message, timestamp]
      properties:
        status:
          type: string
          example: ok
        message:
          type: string
          example: Bombay Engine alive
        timestamp:
          type: string
          format: date-time

    ThursdayChunk:
      type: object
      additionalProperties: false
      required: [cursor, per_page, leagues, next_cursor, is_lite]
      properties:
        cursor:
          type: integer
          minimum: 0
        per_page:
          type: integer
          minimum: 1
          maximum: 10
        leagues:
          type: array
          items:
            type: string
        next_cursor:
          type:
            - integer
            - "null"
          minimum: 0
        is_lite:
          type: boolean

    ThursdayFixtureV3:
      type: object
      additionalProperties: true

    ThursdayReportV3Chunked:
      type: object
      additionalProperties: true
      required: [generated_at, window, fixtures_total, fixtures, chunk]
      properties:
        generated_at:
          type: string
        season_used:
          type:
            - string
            - "null"
        engine_leagues:
          type:
            - array
            - "null"
          items:
            type: string
        window:
          type: object
          additionalProperties: true
        fixtures_total:
          type: integer
        fixtures:
          type: array
          items:
            $ref: "#/components/schemas/ThursdayFixtureV3"
        chunk:
          $ref: "#/components/schemas/ThursdayChunk"

    ThursdayOkChunked:
      type: object
      additionalProperties: true
      required: [status, timestamp, report]
      properties:
        status:
          type: string
          example: ok
        timestamp:
          type: string
          format: date-time
        report:
          $ref: "#/components/schemas/ThursdayReportV3Chunked"

    OkWithReport:
      type: object
      additionalProperties: true
      required: [status, timestamp, report]
      properties:
        status:
          type: string
          example: ok
        timestamp:
          type: string
          format: date-time
        report:
          type: object
          additionalProperties: true

    ErrorWithReportNull:
      type: object
      additionalProperties: true
      required: [status, message, timestamp, report]
      properties:
        status:
          type: string
          example: error
        message:
          type: string
          example: Report not available
        error:
          type:
            - string
            - "null"
        timestamp:
          type: string
          format: date-time
        report:
          type:
            - object
            - "null"
          example: null
