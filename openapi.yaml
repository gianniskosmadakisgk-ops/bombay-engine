openapi: 3.1.1
info:
  title: Bombay Engine API
  version: "1.0.0"
  description: >
    Internal API for Agent Bombay – Thursday v3, Friday Shortlist, Tuesday Recap.
    Το GPT διαβάζει έτοιμα reports και δεν τρέχει το engine.

servers:
  - url: https://bombay-engine.onrender.com

paths:

  # ------------------------------------------------------
  # HEALTHCHECK
  # ------------------------------------------------------
  /healthcheck:
    get:
      operationId: healthcheck
      summary: Healthcheck for Bombay Engine
      responses:
        "200":
          description: Engine is alive
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HealthcheckResponse"

  # ------------------------------------------------------
  # THURSDAY ANALYSIS (v3)
  # ------------------------------------------------------
  /thursday-analysis-v3:
    get:
      operationId: runThursdayAnalysis
      summary: Get latest Thursday analysis (v3)
      description: >
        Διαβάζει το αρχείο logs/thursday_report_v3.json.
        Το engine πρέπει να έχει τρέξει πριν (endpoint /run/thursday-v3).
      responses:
        "200":
          description: Thursday analysis successfully returned
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ThursdayAnalysisResponse"
        "503":
          description: Thursday report not available
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  # ------------------------------------------------------
  # FRIDAY SHORTLIST (v3)
  # ------------------------------------------------------
  /friday-shortlist-v3:
    get:
      operationId: runFridayShortlist
      summary: Get latest Friday shortlist (value + Kelly)
      description: >
        Διαβάζει το αρχείο logs/friday_shortlist_v3.json
        που παράγεται αφού έχει υπάρχει διαθέσιμο Thursday report.
      responses:
        "200":
          description: Friday shortlist returned successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FridayShortlistResponse"
        "503":
          description: Shortlist not available
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  # ------------------------------------------------------
  # TUESDAY WEEKLY RECAP
  # ------------------------------------------------------
  /tuesday-recap:
    get:
      operationId: runTuesdayRecap
      summary: Get Tuesday weekly recap
      description: >
        Διαβάζει logs/tuesday_recap_v2.json (weekly performance report).
      responses:
        "200":
          description: Tuesday recap returned successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TuesdayRecapResponse"
        "503":
          description: Recap not available
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

# =========================================================
# SCHEMAS
# =========================================================
components:
  schemas:

    # --------------------------
    # BASIC
    # --------------------------
    HealthcheckResponse:
      type: object
      properties:
        status:
          type: string
          example: "ok"
        message:
          type: string
          example: "Bombay Engine alive"

    ErrorResponse:
      type: object
      properties:
        status:
          type: string
          example: "error"
        message:
          type: string
          example: "Report not available"
        error:
          type: string
          example: "File missing"
        timestamp:
          type: string
          example: "2025-12-03T13:33:11.351547"

    # --------------------------
    # THURSDAY
    # --------------------------
    ThursdayFixture:
      type: object
      additionalProperties: true

    ThursdayAnalysisReport:
      type: object
      properties:
        fixtures:
          type: array
          items:
            $ref: "#/components/schemas/ThursdayFixture"
        window:
          type: object
          properties:
            date_from:
              type: string
            date_to:
              type: string
            season:
              type: integer
        generated_at:
          type: string

    ThursdayAnalysisResponse:
      type: object
      properties:
        status:
          type: string
        script:
          type: string
        timestamp:
          type: string
        report:
          $ref: "#/components/schemas/ThursdayAnalysisReport"

    # --------------------------
    # FRIDAY SHORTLIST
    # --------------------------
    FridayShortlistItem:
      type: object
      additionalProperties: true

    FridayShortlistReport:
      type: object
      properties:
        picks:
          type: array
          items:
            $ref: "#/components/schemas/FridayShortlistItem"
        generated_at:
          type: string

    FridayShortlistResponse:
      type: object
      properties:
        status:
          type: string
        timestamp:
          type: string
        report:
          $ref: "#/components/schemas/FridayShortlistReport"

    # --------------------------
    # TUESDAY RECAP
    # --------------------------
    TuesdayRecapStats:
      type: object
      additionalProperties: true

    TuesdayRecapResponse:
      type: object
      properties:
        status:
          type: string
        timestamp:
          type: string
        report:
          $ref: "#/components/schemas/TuesdayRecapStats"
