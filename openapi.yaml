openapi: 3.1.0
info:
  title: Bombay Engine API
  version: 1.0.5
  description: |
    Internal API for Agent Bombay v6.x.
    IMPORTANT:
    - Thursday endpoint returns the latest saved Thursday Report V3 inside the 'report' field.
    - Thursday supports chunking via cursor/per_page and can return lite fixtures to avoid ResponseTooLargeError.
    - Friday endpoint returns the latest saved Friday Shortlist V3 inside the 'report' field.
    - Tuesday endpoint returns the latest saved Tuesday Recap V3 inside the 'report' field.
servers:
  - url: https://bombay-engine.onrender.com

paths:
  /healthcheck:
    get:
      operationId: healthcheck
      summary: Health check
      responses:
        "200":
          description: ok
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HealthcheckResponse"

  /thursday-analysis-v3:
    get:
      operationId: runThursdayAnalysis
      summary: Thursday Report V3 (latest saved report) â€” supports chunking
      description: |
        Returns latest saved Thursday Report V3 from logs/thursday_report_v3.json (does NOT run engine).
        To avoid ResponseTooLargeError use query params cursor/per_page and optionally lite=true.
        The Custom GPT must read response.report.
      parameters:
        - name: cursor
          in: query
          required: false
          schema:
            type: integer
            minimum: 0
          description: League cursor index (0-based) for chunking.
        - name: per_page
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 5
          description: Number of leagues to return in this chunk (1..5).
        - name: lite
          in: query
          required: false
          schema:
            type: boolean
          description: If true, returns reduced fixture fields (smaller payload).
      responses:
        "200":
          description: ok
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ThursdayOk"
        "404":
          description: report not available
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorWithReportNull"

  /friday-shortlist-v3:
    get:
      operationId: runFridayShortlist
      summary: Friday Shortlist V3 (latest saved report)
      description: |
        Returns latest saved Friday shortlist from logs/friday_shortlist_v3.json.
        The Custom GPT must read response.report.
      responses:
        "200":
          description: ok
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OkWithReport"
        "404":
          description: report not available
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorWithReportNull"

  /tuesday-recap:
    get:
      operationId: runTuesdayRecap
      summary: Tuesday Recap V3 (latest saved report)
      description: |
        Returns latest saved Tuesday recap from logs/tuesday_recap_v3.json.
        The Custom GPT must read response.report.
      responses:
        "200":
          description: ok
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OkWithReport"
        "404":
          description: report not available
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorWithReportNull"

components:
  schemas:
    HealthcheckResponse:
      type: object
      additionalProperties: true
      required: [status, message, timestamp]
      properties:
        status: { type: string, example: ok }
        message: { type: string, example: Bombay Engine alive }
        timestamp: { type: string, format: date-time }

    ThursdayOk:
      type: object
      additionalProperties: true
      required: [status, timestamp, report]
      properties:
        status: { type: string, example: ok }
        timestamp: { type: string, format: date-time }
        report:
          type: object
          additionalProperties: true
          description: |
            Thursday report. In chunk mode, report.chunk exists and report.fixtures contains only fixtures for chunk leagues.
            report.fixtures_total_all and report.fixtures_chunk_total are additive helpers.

    OkWithReport:
      type: object
      additionalProperties: true
      required: [status, timestamp, report]
      properties:
        status: { type: string, example: ok }
        timestamp: { type: string, format: date-time }
        report:
          type: object
          additionalProperties: true

    ErrorWithReportNull:
      type: object
      additionalProperties: true
      required: [status, message, timestamp, report]
      properties:
        status: { type: string, example: error }
        message: { type: string, example: Report not available }
        error:
          type: [string, "null"]
        timestamp: { type: string, format: date-time }
        report:
          type: [object, "null"]
          example: null
